!function(a){"function"==typeof define&&define.amd?define(["jquery","jquery.easing"],a):a(jQuery)}(function(a){function j(b){this.options=a.extend({direction:"bottom",distance:20,duration:300,space:15,easingOpen:"easeOutCubic",easingClose:"easeOutCubic",delayBeforeOpen:100,delayBeforeClose:0,eventTrigger:"click",delegateTo:null,template:null,content:null,href:null,toggleShow:!1,hideOnOutsideClick:!0,hideOnContentClick:!1},b),this.init()}var c=(/MSIE 10.*Touch/.test(navigator.userAgent)||"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,a("html")),e=(a("body"),a(window)),f="flpopup",g="floating-popup",h="The requested content cannot be loaded",i={styles:function(a){return"object"!=typeof a&&(a=this.rsplt(a)),a.unshift(""),a.join(" "+g+"-").slice(1)},events:function(a){return"object"!=typeof a&&(a=this.rsplt(a)),a.push(""),a.join("."+f+" ").slice(0,-1)},splt:function(a,b){return a.split(b||" ")||[]},rsplt:function(a){return a.match(/\b[a-z0-9-][^\s]*\b/gi)||[]},url:function(a){var a="object"==typeof a?a:a?a.split("/"):[];return[window.location.origin].concat(a).join("/")}};j.prototype={init:function(){this.options.holder&&(this.findElements(),this.createPopup(),this.attachEvents(),this.makeCallback("onInit",this))},findElements:function(){this.control=a(this.options.holder)},createPopup:function(){this.wrapper=a("<div/>").addClass(i.styles("wrapper")).css("display",this.control.css("display")),this.control.wrap(this.wrapper),this.popup=a("<div/>").addClass(i.styles("outer")).insertAfter(this.control),this.inner=a("<div/>").addClass(i.styles("inner")).appendTo(this.popup),this.loadContent()},loadContent:function(b){var b=b||this.options.template||this.options.content||this.options.href||this.control.attr("href"),c=!!this.options.template,d=function(){return a("<p/>").addClass(i.styles("error")).html(h)};b?b.indexOf("#")>-1?(this.holder=a("<div/>").addClass(i.styles("holder")),b=a(b),b=b.length?c?b.clone(!0):b.wrap(this.holder):d()):b=a(b):b=d(),this.content=b.show(),this.inner.html(this.content)},open:function(a){var b=this.options.delayBeforeOpen;this._timer&&clearTimeout(this._timer),a&&this.loadContent(a),b?this._timer=setTimeout(this._open.bind(this),b):this._open.call(this)},close:function(){var a=this.options.delayBeforeClose;this._timer&&clearTimeout(this._timer),this.animation&&(a?this._timer=setTimeout(this._close.bind(this),a):this._close.call(this))},shake:function(){var b=this.animation;this._opened&&(delete b.onclose.opacity,this.calculatePosition(),this.makeCallback("onShake",this),this.popup.animate(a.extend({},b.onclose,b.position),200).animate(b.onopen,1e3,"easeOutElastic"))},_open:function(){var d,e,f,g,h,j,b=this;this.calculatePosition(),d=this.animation,e=d.position,f=d.onopen,g=this.options.duration,h=this.options.easingOpen||null,j=function(){if(b._opened=!0,b.makeCallback("afterOpen",b),b.options.hideOnOutsideClick){var d=i.events("click");c.off(d).on(d,function(e){var f=a(e.target);f.closest(b.popup).length||f.closest(b.control).length||(b.close(),c.off(d))})}},this._opened?this.shake.call(this):(this.makeCallback("beforeOpen",this),this.popup.css(e).show().stop().animate(f,g,h,j))},_close:function(){var a=this;this.makeCallback("beforeClose",this),this.popup.stop().animate(this.animation.onclose,this.options.duration,this.options.easingClose||null,function(){a.popup.hide(),a._opened=!1,a.makeCallback("afterClose",a)})},calculatePosition:function(){var a=this.options.distance,b=this.control.position(),c=this.options.space,d=this.animation={},e=d.position={},f=d.onopen={opacity:"1"},g=d.onclose={opacity:"0"};switch(this.options.direction){case"top":this.inner.addClass("arrow-down"),e.left=-(this.popup.outerWidth()/2)+this.control.outerWidth()/2+b.left,e.bottom=this.control.outerHeight()+a+c-b.top,f.bottom="-="+a,g.bottom="+="+a;break;case"bottom":this.inner.addClass("arrow-up"),e.left=-(this.popup.outerWidth()/2)+this.control.outerWidth()/2+b.left,e.top=this.control.outerHeight()+a+c+b.top,f.top="-="+a,g.top="+="+a;break;case"left":this.inner.addClass("arrow-right"),e.top=-(this.popup.outerHeight()/2)+this.control.outerHeight()/2+b.top,e.right=this.control.outerWidth()+a+c-b.left,f.right="-="+a,g.right="+="+a;break;case"right":default:this.inner.addClass("arrow-left"),e.top=-(this.popup.outerHeight()/2)+this.control.outerHeight()/2+b.top,e.left=this.control.outerWidth()+a+c+b.left,f.left="-="+a,g.left="+="+a}},attachEvents:function(){var b=this,c=this.options.eventTrigger;c&&this.control.on(i.events(c),this.options.delegateTo,function(d){d.preventDefault(),a.isArray(c)&&c.length>1&&d.type===c[1]?b.close():b.popup.is(":animated")||!b.options.toggleShow&&b._opened||(b.options.toggleShow&&b._opened?b.close():b.open())}),this.inner.on(i.events("click"),function(a){b.options.hideOnContentClick?(a.preventDefault(),b.close()):b.makeCallback("onContentClick",a)})},bindHandlers:function(b){var c=this;a.each(b,function(a,b){var d=c[b];c[b]=function(){return d.apply(c,arguments)}})},makeCallback:function(a){if("function"==typeof this.options[a]){var b=Array.prototype.slice.call(arguments);b.shift(),this.options[a].apply(this,b)}},destroy:function(){(ET=this.options.eventTrigger)&&this.control.off(i.events(ET))},isOpened:function(){return this._opened},goViewport:function(b){var c=e.scrollTop(),d=this.popup.offset().top,f=d,g=d-10;duration=330;var b="function"==typeof b?b.bind(this):null,h=0;c>f?a("body,html").animate({scrollTop:g},duration,function(){h++||b.call()}):b.call()}},a.fn.floatingPopup=function(b){return this.each(function(){a(this).data("floatingPopup",new j(a.extend(b,{holder:this})))})}});