!function(a){a.fn.etalage=function(b){var c=a.extend({align:"left",thumb_image_width:300,thumb_image_height:400,source_image_width:900,source_image_height:1200,zoom_area_width:600,zoom_area_height:"justify",zoom_area_distance:10,zoom_easing:!0,click_to_zoom:!1,zoom_element:"auto",zoom_enable:!0,show_descriptions:!0,description_location:"bottom",description_opacity:.7,small_thumbs:3,small_thumbs_width_offset:0,smallthumb_inactive_opacity:.4,smallthumb_hide_single:!0,smallthumb_select_on_hover:!1,smallthumbs_position:"bottom",show_begin_end_smallthumb:!0,magnifier_opacity:.5,magnifier_invert:!0,show_icon:!0,icon_offset:20,hide_cursor:!1,show_hint:!1,hint_offset:15,speed:600,autoplay:!0,autoplay_interval:6e3,keyboard:!0,right_to_left:!1,click_callback:function(){return!0},change_callback:function(){return!0}},b);return a.each(this,function(){function Sa(a){r=r?r-1:0,q=!0;var e,f,g,h,c=b.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),d=b.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"left"===a?(e=c.prev().addClass("etalage_smallthumb_first"),f=d.prev().addClass("etalage_smallthumb_last"),g=c):(e=c.next().addClass("etalage_smallthumb_first"),f=d.next().addClass("etalage_smallthumb_last"),g=d),r?"left"===a?e.trigger("click"):f.trigger("click"):(h="vert"===A?e.position().top:e.position().left,Ja(h,e,f,g))}function Ta(a){q=!0;var e,f,g;b.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),b.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"end"===a?(e=S.eq(U-V).addClass("etalage_smallthumb_first"),f=S.eq(U-1).addClass("etalage_smallthumb_last"),g=f,f.hasClass("etalage_smallthumb_navtostart")&&(g=f.prev())):(e=S.eq(0).addClass("etalage_smallthumb_first"),f=S.eq(V-1).addClass("etalage_smallthumb_last"),g=e,e.hasClass("etalage_smallthumb_navtoend")&&(g=e.next()));var h="vert"===A?e.position().top:e.position().left;Ja(h,e,f,g)}function Ua(){Ta("start")}function Va(){Ta("end")}var b=a(this);if(b.is("ul")&&b.children("li").length&&b.find("img.etalage_source_image").length){var d,e,f,g,h,i,j,k,l,m,n=b.attr("id"),o=Math.floor(.7*c.speed),p=Math.round(c.speed/100),q=!1,r=0,s=!1,t=!0,u=!1,v=0,w=0,x=0,y=0,z=0,A="hori";"undefined"!=typeof n&&n||(n="[no id]"),"left"!==c.smallthumbs_position&&"right"!==c.smallthumbs_position||(A="vert"),"object"==typeof a.browser&&a.browser.msie&&a.browser.version<9&&(t=!1,a.browser.version<7&&(s=!0)),b.addClass("etalage").show();var B;B=b.children("li").first().hasClass("etalage_thumb")?b.children("li.etalage_thumb"):b.children("li").addClass("etalage_thumb"),b.children("li.etalage_thumb_active").hide().removeClass("etalage_thumb_active"),B.first().show().addClass("etalage_thumb_active").css("opacity",1);var C=B.length,D=c.autoplay;C<2&&(D=!1),"right"===c.align&&b.addClass("etalage_right"),a.each(B,function(b){b+=1;var c=a(this),d=c.find(".etalage_thumb_image").show(),e=c.find(".etalage_source_image"),f=c.find("a");c.data("id",b).addClass("thumb_"+b),!d.length&&e.length?c.prepend('<img class="etalage_thumb_image" src="'+e.attr("src")+'" />'):d.length||e.length||c.remove(),f.length&&c.find(".etalage_thumb_image").data("anchor",f.attr("href"))});var E=B.find(".etalage_thumb_image").css({width:c.thumb_image_width,height:c.thumb_image_height}).show();a.each(E,function(){a(this).data("src",this.src),a(this).data("title",this.alt)});var F;b.children("li.etalage_magnifier").remove(),F=a('<li class="etalage_magnifier"><div><img /></div></li>').appendTo(b);var I,G=F.children("div"),H=G.children("img");b.children("li.etalage_icon").remove(),I=a('<li class="etalage_icon">&nbsp;</li>').appendTo(b),c.show_icon&&I.show();var J;c.show_hint&&(b.children("li.etalage_hint").remove(),J=a('<li class="etalage_hint">&nbsp;</li>').appendTo(b).show());var K,L=c.zoom_element;"auto"!==L&&L&&a(L).length?K=a(L).addClass("etalage_zoom_area").html('<div><img class="etalage_zoom_img" /></div>'):(L="auto",b.children("li.etalage_zoom_area").remove(),K=a('<li class="etalage_zoom_area"><div><img class="etalage_zoom_img" /></div></li>').appendTo(b));var N,M=K.children("div");t&&(N=a('<img class="etalage_zoom_preview" />').css({width:c.source_image_width,height:c.source_image_height,opacity:.3}).prependTo(M).show());var P,O=M.children(".etalage_zoom_img").css({width:c.source_image_width,height:c.source_image_height});c.show_descriptions&&(P=a('<div class="etalage_description'+(c.right_to_left?" rtl":"")+'"></div>').prependTo(K));var Q,R,S,T,U,V=c.small_thumbs,W=c.small_thumbs_width_offset;(C>1||!c.smallthumb_hide_single)&&(b.children("li.etalage_small_thumbs").remove(),Q=a('<li class="etalage_small_thumbs"><ul></ul></li>').appendTo(b),R=Q.children("ul"),a.each(E,function(){var b=a(this);f=b.data("src"),title=b.data("title"),g=b.parents(".etalage_thumb").data("id"),a('<li title="'+title+'"><img class="etalage_small_thumb" src="'+f+'" /></li>').data("thumb_id",g).appendTo(R)}),S=R.children("li").css({opacity:c.smallthumb_inactive_opacity}),V<3&&(V=3),C>V?(c.show_begin_end_smallthumb?(f=E.eq(C-1).data("src"),title=E.eq(C-1).data("title"),g=B.eq(C-1).data("id"),a('<li class="etalage_smallthumb_first etalage_smallthumb_navtoend" title="'+title+'"><img class="etalage_small_thumb" src="'+f+'" /></li>').data("src",f).data("thumb_id",g).css({opacity:c.smallthumb_inactive_opacity}).prependTo(R),f=E.eq(0).data("src"),title=E.eq(0).data("title"),g=B.eq(0).data("id"),a('<li class="etalage_smallthumb_navtostart" title="'+title+'"><img class="etalage_small_thumb" src="'+f+'" /></li>').data("src",f).data("thumb_id",g).css({opacity:c.smallthumb_inactive_opacity}).appendTo(R),S=R.children("li"),S.eq(1).addClass("etalage_smallthumb_active").css({opacity:1})):S.eq(0).addClass("etalage_smallthumb_first etalage_smallthumb_active").css({opacity:1}),S.eq(V-1).addClass("etalage_smallthumb_last")):S.eq(0).addClass("etalage_smallthumb_active").css({opacity:1}),a.each(S,function(b){a(this).data("id",b+1)}),T=S.children("img"),U=S.length,"vert"===A&&S.addClass("vertical")),h=c.magnifier_invert?1:c.magnifier_opacity;var X=parseInt(B.css("borderLeftWidth"),10)+parseInt(B.css("borderRightWidth"),10)+parseInt(E.css("borderLeftWidth"),10)+parseInt(E.css("borderRightWidth"),10),Y=parseInt(B.css("marginLeft"),10)+parseInt(B.css("marginRight"),10),Z=parseInt(B.css("paddingLeft"),10)+parseInt(B.css("paddingRight"),10)+parseInt(E.css("marginLeft"),10)+parseInt(E.css("marginRight"),10)+parseInt(E.css("paddingLeft"),10)+parseInt(E.css("paddingRight"),10),$=c.thumb_image_width+X+Y+Z,_=c.thumb_image_height+X+Y+Z,aa=0,ba=0,ca=0,da=0,ea=0,fa=0,ga=0;(C>1||!c.smallthumb_hide_single)&&(aa=parseInt(S.css("borderLeftWidth"),10)+parseInt(S.css("borderRightWidth"),10)+parseInt(T.css("borderLeftWidth"),10)+parseInt(T.css("borderRightWidth"),10),ba=parseInt(S.css("marginTop"),10),ca=parseInt(S.css("paddingLeft"),10)+parseInt(S.css("paddingRight"),10)+parseInt(T.css("marginLeft"),10)+parseInt(T.css("marginRight"),10)+parseInt(T.css("paddingLeft"),10)+parseInt(T.css("paddingRight"),10),"vert"===A?(ea=Math.round((_-(V-1)*ba)/V)-(aa+ca),da=Math.round(c.thumb_image_width*ea/c.thumb_image_height),fa=da+aa+ca,ga=ea+aa+ca):(da=Math.round(($+W-(V-1)*ba)/V)-(aa+ca),ea=Math.round(c.thumb_image_height*da/c.thumb_image_width),fa=da+aa+ca,ga=ea+aa+ca));var ka,la,ha=parseInt(K.css("borderTopWidth"),10),ia=parseInt(c.zoom_area_distance,10),ja=parseInt(K.css("paddingTop"),10);ka=c.zoom_area_width-2*ha-2*ja>c.source_image_width?c.source_image_width:c.zoom_area_width-2*ha-2*ja,la="justify"===c.zoom_area_height?_+ba+ga-2*ha-2*ja:c.zoom_area_height-2*ha-2*ja,la>c.source_image_height&&(la=c.source_image_height);var ma,na,oa,pa;c.show_descriptions&&(ma=parseInt(P.css("borderLeftWidth"),10)+parseInt(P.css("borderRightWidth"),10),na=parseInt(P.css("marginLeft"),10)+parseInt(P.css("marginRight"),10),oa=parseInt(P.css("paddingLeft"),10)+parseInt(P.css("paddingRight"),10),pa=ka-ma-na-oa);var qa;s&&(qa=a('<iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="javascript:\'<html></html>\'"></iframe>').css({position:"absolute",zIndex:1}).prependTo(K));var ra=parseInt(F.css("borderTopWidth"),10),sa=parseInt(B.css("borderTopWidth"),10)+parseInt(B.css("marginTop"),10)+parseInt(B.css("paddingTop"),10)+parseInt(E.css("borderTopWidth"),10)+parseInt(E.css("marginTop"),10)-ra,ta=E.offset().left-b.offset().left-ra;"left"===c.smallthumbs_position?ta=ta+fa+ba:"top"===c.smallthumbs_position&&(sa=sa+ga+ba);var Aa,Ba,ua=Math.round(ka*(c.thumb_image_width/c.source_image_width)),va=Math.round(la*(c.thumb_image_height/c.source_image_height)),wa=sa+c.thumb_image_height-va,xa=ta+c.thumb_image_width-ua,ya=Math.round(ua/2),za=Math.round(va/2);if(c.show_hint&&(Aa=parseInt(c.hint_offset,10)+parseInt(J.css("marginTop"),10),Ba=parseInt(c.hint_offset,10)+parseInt(J.css("marginRight"),10),"right"===c.smallthumbs_position&&(Ba=Ba-fa-ba)),"vert"===A?(k=$+ba+fa,b.css({width:k,height:_})):(k=$,b.css({width:k,height:_+ba+ga})),c.show_icon&&(m={top:_-I.outerHeight(!0)-parseInt(c.icon_offset,10),left:parseInt(c.icon_offset,10)},"left"===c.smallthumbs_position?m.left=fa+ba+parseInt(c.icon_offset,10):"top"===c.smallthumbs_position&&(m.top+=ga+ba),I.css(m)),c.show_hint&&J.css({margin:0,top:-Aa,right:-Ba}),H.css({margin:0,padding:0,width:c.thumb_image_width,height:c.thumb_image_height}),G.css({margin:0,padding:0,width:ua,height:va}),m={margin:0,padding:0,left:(xa-ta)/2,top:(wa-sa)/2},"left"===c.smallthumbs_position?m.left="+="+fa+ba:"top"===c.smallthumbs_position&&(m.top="+="+ga+ba),F.css(m).hide(),M.css({width:ka,height:la}),m={margin:0,opacity:0},"right"===c.align&&"auto"===L?m.left=-(ka+2*ha+2*ja+ia):"auto"===L&&(m.left=k+ia),K.css(m).hide(),c.show_descriptions&&(m={width:pa,bottom:ja,left:ja,opacity:c.description_opacity},"top"===c.description_location&&(m.top=ja,m.bottom="auto"),P.css(m).hide()),C>1||!c.smallthumb_hide_single)if("vert"===A?(m={top:0,height:_},"left"===c.smallthumbs_position?B.css({left:fa+ba}):m.marginLeft=$+ba,Q.css(m),R.css({height:ga*U+U*ba+100}),T.css({width:da,height:ea}).attr("height",ea),S.css({margin:0,marginBottom:ba})):(m={width:$+W,left:-W/2},"top"===c.smallthumbs_position?B.css({top:ga+ba}):m.top=_+ba,Q.css(m),R.css({width:fa*U+U*ba+100}),T.css({width:da,height:ea}).attr("width",da),S.css({margin:0,marginRight:ba})),l="vert"===A?ga*V+(V-1)*ba-_:fa*V+(V-1)*ba-$,l>0)for(d=1;d<=U-1;d+=V-1)for(e=1;e<=l;e+=1)"vert"===A?S.eq(d+e-1).css({marginBottom:ba-1}):S.eq(d+e-1).css({marginRight:ba-1});else if(l<0)for(d=1;d<=U-1;d+=V-1)for(e=1;e<=-l;e+=1)"vert"===A?(S.eq(d+e-1).css({marginBottom:ba+1}),R.css({height:parseInt(R.css("height"),10)+1})):(S.eq(d+e-1).css({marginRight:ba+1}),R.css({width:parseInt(R.css("width"),10)+1}));c.show_icon&&!c.magnifier_invert&&F.css({background:F.css("background-color")+" "+I.css("background-image")+" center no-repeat"}),c.hide_cursor&&F.add(I).css({cursor:"none"}),s&&qa.css({width:M.css("width"),height:M.css("height")});var Ca=B.first().find(".etalage_thumb_image"),Da=B.first().find(".etalage_source_image");c.magnifier_invert&&H.attr("src",Ca.data("src")).show(),t&&N.attr("src",Ca.data("src")),O.attr("src",Da.attr("src")),c.show_descriptions&&(j=Da.attr("title"),j&&P.html(j).show());var Ea=function(){i&&(clearInterval(i),i=!1)},Fa=function(){i&&Ea(),i=setInterval(function(){Ma()},c.autoplay_interval)},Ga=function(){1==c.zoom_enable&&(F.stop().fadeTo(o,h),I.stop().animate({opacity:0},o),K.stop().show().animate({opacity:1},o),c.magnifier_invert&&Ca.stop().animate({opacity:c.magnifier_opacity},o),D&&Ea())},Ha=function(){F.stop().fadeOut(c.speed),I.stop().animate({opacity:1},c.speed),K.stop().animate({opacity:0},c.speed,function(){a(this).hide()}),c.magnifier_invert&&Ca.stop().animate({opacity:1},c.speed,function(){c.click_to_zoom&&(u=!1)}),clearTimeout(v),D&&Fa()},Ia=function(d,e){var f,g,h=b.find(".etalage_smallthumb_active").removeClass("etalage_smallthumb_active");d.addClass("etalage_smallthumb_active"),F.stop().hide(),K.stop().hide(),e||(q=!0,h.stop(!0,!0).animate({opacity:c.smallthumb_inactive_opacity},o),d.stop(!0,!0).animate({opacity:1},o,function(){q=!1})),b.find(".etalage_thumb_active").removeClass("etalage_thumb_active").stop().animate({opacity:0},c.speed,function(){a(this).hide()}),f=B.filter(".thumb_"+d.data("thumb_id")).addClass("etalage_thumb_active").show().stop().css({opacity:0}).animate({opacity:1},c.speed),Ca=f.find(".etalage_thumb_image"),Da=f.find(".etalage_source_image"),c.magnifier_invert&&H.attr("src",Ca.data("src")),t&&N.attr("src",Ca.data("src")),O.attr("src",Da.attr("src")),c.show_descriptions&&(j=Da.attr("title"),j?P.html(j).show():P.hide()),D&&(Ea(),Fa()),g=d.data("id"),C>=V&&g--,Pa(g)},Ja=function(b,d,e,f){a.each(S,function(){var d=a(this),e={opacity:c.smallthumb_inactive_opacity};d.data("id")===f.data("id")&&(e.opacity=1),"vert"===A?e.top="-="+b:e.left="-="+b,d.animate(e,o,"swing",function(){q&&(f.addClass("etalage_smallthumb_active"),q=!1)})}),Ia(f,!0)},Ka=function(){var a=y-w,b=z-x,c=-a/p,d=-b/p;w-=c,x-=d,a<1&&a>-1&&(w=y),b<1&&b>-1&&(x=z),O.css({left:w,top:x}),t&&N.css({left:w,top:x}),(a>1||b>1||a<1||b<1)&&(v=setTimeout(function(){Ka()},25))},La=function(){var a;if(c.magnifier_invert&&b.find(".etalage_thumb_active").mouseleave(),c.right_to_left){if(a=b.find(".etalage_smallthumb_active").next(),!a.length)return C>V?Ua():S.first().trigger("click"),!0}else if(a=b.find(".etalage_smallthumb_active").prev(),!a.length)return C>V?Va():S.last().trigger("click"),!0;a.trigger("click")},Ma=function(){var a;if(c.magnifier_invert&&b.find(".etalage_thumb_active").mouseleave(),c.right_to_left){if(a=b.find(".etalage_smallthumb_active").prev(),!a.length)return C>V?Va():S.last().trigger("click"),!0}else if(a=b.find(".etalage_smallthumb_active").next(),!a.length)return C>V?Ua():S.first().trigger("click"),!0;a.trigger("click")},Na=function(a){(C<=V||!c.show_begin_end_smallthumb)&&(a-=1);var d=S.eq(a);if(d.length&&!q){var g,e=b.find(".etalage_smallthumb_active"),f=e.data("id")-1;if(f>a){r=f-a;var h=b.find(".etalage_smallthumb_first"),i=h.data("id");a<i?(g=f-i,r-=g,h.trigger("click")):Ia(d,!1)}else if(f<a){r=a-f;var j=b.find(".etalage_smallthumb_last"),k=j.data("id")-1;a>=k?(g=k-f-1,r-=g,j.trigger("click")):Ia(d,!1)}}};window[n+"_previous"]=function(){La()},window[n+"_next"]=function(){Ma()},window[n+"_show"]=function(a){Na(a)};var Oa=function(a){return!!c.click_callback(a,n)&&("function"!=typeof etalage_click_callback||(etalage_click_callback(a,n),!1))},Pa=function(a){c.change_callback(a,n)&&"function"==typeof etalage_change_callback&&etalage_change_callback(a,n)};B.add(F).add(I).mouseenter(function(){c.show_hint&&J.hide(),c.click_to_zoom&&!u||Ga()}).mouseleave(function(){Ha()});var Qa=-(c.source_image_width-ka),Ra=-(c.source_image_height-la);B.add(F).add(I).mousemove(function(a){var b=Math.round(a.pageX-Ca.offset().left+ta),d=Math.round(a.pageY-Ca.offset().top+sa),e=b-ya,f=d-za;if(e<ta&&(e=ta),e>xa&&(e=xa),f<sa&&(f=sa),f>wa&&(f=wa),F.css({left:e,top:f}),c.magnifier_invert){var g=e-ta,h=f-sa;H.css({left:-g,top:-h})}y=-((e-ta)*(1/(c.thumb_image_width/c.source_image_width))),z=-((f-sa)*(1/(c.thumb_image_height/c.source_image_height))),y<Qa&&(y=Qa),z<Ra&&(z=Ra),c.zoom_easing?(clearTimeout(v),Ka()):(t&&N.css({left:y,top:z}),O.css({left:y,top:z}))}),(C>1||!c.smallthumb_hide_single)&&(S.click(function(){var b=a(this);if(!b.hasClass("etalage_smallthumb_active")&&(!q||r))if(b.hasClass("etalage_smallthumb_first")&&b.prev().length)Sa("left");else if(b.hasClass("etalage_smallthumb_navtoend"))Va();else if(b.hasClass("etalage_smallthumb_last")&&b.next().length)Sa("right");else if(b.hasClass("etalage_smallthumb_navtostart"))Ua();else{if(r&&!a(this).next().length)return Va(),!0;if(r&&!a(this).prev().length)return Ua(),!0;Ia(b,!1)}}),c.smallthumb_select_on_hover&&S.mouseenter(function(){a(this).trigger("click")})),c.click_to_zoom?B.click(function(){u=!0,Ga()}):F.click(function(){var a=Ca.data("anchor");a&&Oa(a)&&(window.location=a)}),C>1&&c.keyboard&&a(document).keydown(function(a){39!==a.keyCode&&"39"!==a.keyCode||(c.right_to_left?La():Ma()),37!==a.keyCode&&"37"!==a.keyCode||(c.right_to_left?Ma():La())}),a(window).bind("load",function(){B.css({"background-image":"none"}),K.css({"background-image":"none"}),t&&(t=!1,N.remove())}),D&&Fa()}}),this}}(jQuery);