!function(a){a.fn.selectbox=function(b){var c=a.extend({styleClass:""},b);a(this).each(function(){function e(){var c=d.find("option"),e=c.filter(":selected"),f=c.filter(":first").text();c.filter(":first").attr("data-image")&&(f='<img src="'+c.filter(":first").attr("data-image")+'"/>'+f),e.length&&(f=e.text(),e.attr("data-image")&&(f='<img src="'+e.attr("data-image")+'"/>'+f));var g="";for(i=0;i<c.length;i++){var h="",j=' class="disabled"';c.eq(i).is(":selected")?(h=' class="selected sel"',g+="<li"+h+"><a>",c.eq(i).attr("data-image")&&(g+='<img src="'+c.eq(i).attr("data-image")+'"/>'),g+=c.eq(i).text()+"</a></li>"):c.eq(i).is(":disabled")?(h=j,g+="<li"+h+"><a>"+c.eq(i).text()+"</a></li>"):(g+="<li"+h+'><a href="'+c.eq(i).val()+'">',c.eq(i).attr("data-image")&&(g+='<img src="'+c.eq(i).attr("data-image")+'"/>'),g+=c.eq(i).html()+"</a></li>")}var k=a('<span class="selectbox '+b+'" style="display:inline-block;position:relative"><div class="select" style="float:left;position:relative;z-index:10000"><div class="text">'+f+'</div><b class="trigger"><i class="icon-down-dir"></i></b></div><div class="dropdown" style="position:absolute;z-index:9999;overflow:auto;overflow-x:hidden;list-style:none"><ul>'+g+"</ul></div></span>");d.before(k).css({position:"absolute",top:-9999});var l=k.find("div.select"),m=k.find("div.text"),n=k.find("div.dropdown"),o=n.find("li"),p=k.outerHeight();"auto"==n.css("left")&&n.css({left:0}),"auto"!=n.css("top")&&"0px"!=n.css("top")||n.css({top:p});var q=o.outerHeight(),r=n.css("top");n.hide(),n.css("width",n.parent().width()+"px"),l.mouseover(function(){var b=k.offset().top,c=a(window).height()-p-(b-a(window).scrollTop());return c<0||c<6*q?(n.height("auto").css({top:"auto",bottom:r}),n.addClass("top-dropdown"),n.outerHeight()>b-a(window).scrollTop()-20&&n.height(Math.floor((b-a(window).scrollTop()-20)/q)*q)):c>6*q&&(n.height("auto").css({bottom:"auto",top:r}),n.outerHeight()>c-20&&n.height(Math.floor((c-20)/q)*q)),n.css("width",n.parent().width()+"px"),a("span.selectbox").css({zIndex:1}).removeClass("focused"),k.css({zIndex:4}),n.is(":hidden")&&(a("div.dropdown:visible").hide(),n.fadeIn("fast")),!1}),a("span.selectbox").mouseleave(function(){return n.fadeOut("fast"),n.removeClass("top-dropdown"),!1}),o.hover(function(){a(this).siblings().removeClass("selected")});var s=o.filter(".selected").text();o.filter(":not(.disabled)").click(function(){var b=a(this).text();s!=b&&(a(this).addClass("selected sel").siblings().removeClass("selected sel"),c.removeAttr("selected").eq(a(this).index()).attr("selected",!0),s=b,m.text(b),d.change()),n.hide()}),n.mouseout(function(){n.find("li.sel").addClass("selected")}),d.focus(function(){a("span.selectbox").removeClass("focused"),k.addClass("focused")}).keyup(function(){m.text(c.filter(":selected").text()),o.removeClass("selected sel").eq(c.filter(":selected").index()).addClass("selected sel")}),a(document).on("click",function(b){a(b.target).parents().hasClass("selectbox")||(n.hide().find("li.sel").addClass("selected"),k.removeClass("focused"))})}var b=c.styleClass,d=a(this);d.prev("span.selectbox").length<1&&(e(),d.on("refresh",function(){d.prev().remove(),e()}))})}}(jQuery);