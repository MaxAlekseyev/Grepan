if("undefined"==typeof Product)var Product={};Product.Config=Class.create(),Product.Config.prototype={initialize:function(a){this.config=a,this.taxConfig=this.config.taxConfig,a.containerId?this.settings=$$("#"+a.containerId+" .super-attribute-select"):this.settings=$$(".super-attribute-select"),this.state=new Hash,this.priceTemplate=new Template(this.config.template),this.prices=a.prices,a.defaultValues&&(this.values=a.defaultValues);var b=window.location.href.indexOf("#");if(b!=-1){var c=window.location.href.substr(b+1),d=c.toQueryParams();this.values||(this.values={});for(var e in d)this.values[e]=d[e]}a.inputsInitialized&&(this.values={},this.settings.each(function(a){if(a.value){var b=a.id.replace(/[a-z]*/,"");this.values[b]=a.value}}.bind(this))),this.settings.each(function(a){Event.observe(a,"change",this.configure.bind(this))}.bind(this)),this.settings.each(function(a){var b=a.id.replace(/[a-z]*/,"");b&&this.config.attributes[b]&&(a.config=this.config.attributes[b],a.attributeId=b,this.state[b]=!1)}.bind(this));for(var f=[],e=this.settings.length-1;e>=0;e--){var g=!!this.settings[e-1]&&this.settings[e-1],h=!!this.settings[e+1]&&this.settings[e+1];0==e?this.fillSelect(this.settings[e]):this.settings[e].disabled=!0,$(this.settings[e]).childSettings=f.clone(),$(this.settings[e]).prevSetting=g,$(this.settings[e]).nextSetting=h,f.push(this.settings[e])}this.configureForValues(),document.observe("dom:loaded",this.configureForValues.bind(this))},configureForValues:function(){this.values&&this.settings.each(function(a){var b=a.attributeId;a.value="undefined"==typeof this.values[b]?"":this.values[b],this.configureElement(a)}.bind(this))},configure:function(a){var b=Event.element(a);this.configureElement(b)},configureElement:function(a){this.reloadOptionLabels(a),a.value?(this.state[a.config.id]=a.value,a.nextSetting&&(a.nextSetting.disabled=!1,this.fillSelect(a.nextSetting),this.resetChildren(a.nextSetting))):this.resetChildren(a),this.reloadPrice()},reloadOptionLabels:function(a){var b;b=a.options[a.selectedIndex].config&&!this.config.stablePrices?parseFloat(a.options[a.selectedIndex].config.price):0;for(var c=0;c<a.options.length;c++)a.options[c].config&&(a.options[c].text=this.getOptionLabel(a.options[c].config,a.options[c].config.price-b))},resetChildren:function(a){if(a.childSettings)for(var b=0;b<a.childSettings.length;b++)a.childSettings[b].selectedIndex=0,a.childSettings[b].disabled=!0,a.config&&(this.state[a.config.id]=!1)},fillSelect:function(a){var b=a.id.replace(/[a-z]*/,""),c=this.getAttributeOptions(b);this.clearSelect(a),a.options[0]=new Option("",""),a.options[0].innerHTML=this.config.chooseText;var d=!1;if(a.prevSetting&&(d=a.prevSetting.options[a.prevSetting.selectedIndex]),c)for(var e=1,f=0;f<c.length;f++){var g=[];if(d)for(var h=0;h<c[f].products.length;h++)d.config.allowedProducts&&d.config.allowedProducts.indexOf(c[f].products[h])>-1&&g.push(c[f].products[h]);else g=c[f].products.clone();g.size()>0&&(c[f].allowedProducts=g,a.options[e]=new Option(this.getOptionLabel(c[f],c[f].price),c[f].id),"undefined"!=typeof c[f].price&&a.options[e].setAttribute("price",c[f].price),a.options[e].config=c[f],e++)}},getOptionLabel:function(a,b){var b=parseFloat(b);if(this.taxConfig.includeTax)var c=b/(100+this.taxConfig.defaultTax)*this.taxConfig.defaultTax,d=b-c,e=d*(1+this.taxConfig.currentTax/100);else var c=b*(this.taxConfig.currentTax/100),d=b,e=d+c;b=this.taxConfig.showIncludeTax||this.taxConfig.showBothPrices?e:d;var f=a.label;return b&&(f+=this.taxConfig.showBothPrices?" "+this.formatPrice(d,!0)+" ("+this.formatPrice(b,!0)+" "+this.taxConfig.inclTaxTitle+")":" "+this.formatPrice(b,!0)),f},formatPrice:function(a,b){var c="";a=parseFloat(a),b&&(a<0?(c+="-",a=-a):c+="+");var d=(Math.round(100*a)/100).toString();return c+=this.prices&&this.prices[d]?this.prices[d]:this.priceTemplate.evaluate({price:a.toFixed(2)})},clearSelect:function(a){for(var b=a.options.length-1;b>=0;b--)a.remove(b)},getAttributeOptions:function(a){if(this.config.attributes[a])return this.config.attributes[a].options},reloadPrice:function(){if(!this.config.disablePriceReload){for(var a=0,b=0,c=this.settings.length-1;c>=0;c--){var d=this.settings[c].options[this.settings[c].selectedIndex];d.config&&(a+=parseFloat(d.config.price),b+=parseFloat(d.config.oldPrice))}return optionsPrice.changePrice("config",{price:a,oldPrice:b}),optionsPrice.reload(),a}},reloadOldPrice:function(){if(!this.config.disablePriceReload&&$("old-price-"+this.config.productId)){for(var a=parseFloat(this.config.oldPrice),b=this.settings.length-1;b>=0;b--){var c=this.settings[b].options[this.settings[b].selectedIndex];c.config&&(a+=parseFloat(c.config.price))}a<0&&(a=0),a=this.formatPrice(a),$("old-price-"+this.config.productId)&&($("old-price-"+this.config.productId).innerHTML=a)}}};